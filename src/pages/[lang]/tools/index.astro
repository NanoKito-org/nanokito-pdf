---
import Layout from "../../../layouts/Layout.astro";
import { tools, categoryLabels, type ToolCategory } from "../../../data/tools";
import ToolCard from "../../../components/ToolCard.astro";
import { Search, Code, Image, FileText, File, Grid } from "lucide-react";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";
import CategoryBadge from "../../../components/CategoryBadge.astro";

export function getStaticPaths() {
  return [{ params: { lang: "en" } }, { params: { lang: "fr" } }];
}

const { lang } = Astro.params;
const t = useTranslations(lang as "en" | "fr");

// Icon map helper
const iconMap: Record<string, any> = {
  Code,
  Braces: Code, // Mapping Braces to Code for now or could import Braces
  Fingerprint: Code, // Using Code for now if Fingerprint not imported, or import it
  Image,
  RefreshCw: Image, // Using Image or import RefreshCw
  FileText,
  Type: FileText,
  File,
};

// Import needed icons dynamically would be better, but for now we map manually
// Let's import the missing ones
import { Braces, Fingerprint, RefreshCw, Type, Lock } from "lucide-react";
Object.assign(iconMap, { Braces, Fingerprint, RefreshCw, Type, Lock });

const allCategories: ToolCategory[] = ["developer", "image", "text", "pdf"];
---

<Layout
  title={`${t("tools.allTitle")} | NanoKito`}
  description={t("tools.allSubtitle")}
>
  <div class="container mx-auto px-4 py-12 max-w-6xl">
    {/* Page Header */}
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-[var(--color-foreground)] mb-4">
        {t("tools.allTitle")}
      </h1>
      <p class="text-[var(--color-muted-foreground)] text-lg">
        {t("tools.allSubtitle")}
      </p>
    </div>

    {/* Search & Filter Section */}
    <div class="mb-12 space-y-6">
      {/* Search Bar */}
      <div class="max-w-md mx-auto relative group">
        <div
          class="absolute -inset-0.5 bg-gradient-to-r from-[var(--color-primary)] to-orange-500 rounded-lg blur opacity-20 group-hover:opacity-40 transition duration-500"
        >
        </div>
        <div
          class="relative bg-white dark:bg-gray-900 rounded-lg flex items-center p-2 border border-gray-200 dark:border-gray-800 shadow-sm"
        >
          <Search className="w-5 h-5 text-gray-400 ml-2" />
          <input
            type="text"
            id="tool-search"
            placeholder={t("tools.searchPlaceholder")}
            class="w-full bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 ml-3 h-10 focus:ring-0"
          />
        </div>
      </div>

      {/* Category Pills */}
      <div class="flex flex-wrap justify-center gap-2">
        <a href={`/${lang}/tools`} class="no-underline">
          <CategoryBadge
            active={true}
            class="px-4 py-1.5 text-sm cursor-pointer hover:bg-yellow-400/20"
          >
            {t("tools.filterAll")}
          </CategoryBadge>
        </a>
        {
          allCategories.map((cat) => (
            <a href={`/${lang}/tools/${cat}`} class="no-underline">
              <CategoryBadge class="px-4 py-1.5 text-sm cursor-pointer hover:bg-slate-700 hover:text-white">
                {categoryLabels[cat][lang as "en" | "fr"]}
              </CategoryBadge>
            </a>
          ))
        }
      </div>
    </div>

    {/* Tools Grid */}
    <div
      id="tools-grid"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
    >
      {
        tools.map((tool) => {
          const Icon = iconMap[tool.icon] || Code;
          return (
            <ToolCard
              title={tool.title[lang as string]}
              description={tool.description[lang as string]}
              href={`/${lang}/tools/${tool.slug}`}
              category={categoryLabels[tool.category][lang as string]}
            >
              <Icon slot="icon" className="w-6 h-6" />
            </ToolCard>
          );
        })
      }
    </div>
  </div>
</Layout>

<script>
  const searchInput = document.getElementById(
    "tool-search",
  ) as HTMLInputElement;
  const toolsGrid = document.getElementById("tools-grid");

  if (searchInput && toolsGrid) {
    searchInput.addEventListener("input", (e) => {
      const searchTerm = (e.target as HTMLInputElement).value.toLowerCase();
      const cards = toolsGrid.querySelectorAll("[data-tool-card]");

      cards.forEach((card) => {
        const title = (card as HTMLElement).dataset.title || "";
        const desc = (card as HTMLElement).dataset.description || "";

        if (title.includes(searchTerm) || desc.includes(searchTerm)) {
          (card as HTMLElement).style.display = "flex";
        } else {
          (card as HTMLElement).style.display = "none";
        }
      });
    });
  }
</script>

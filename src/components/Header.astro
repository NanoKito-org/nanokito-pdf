---
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import LanguagePicker from "./LanguagePicker.astro";
import { ThemeToggle } from "./ThemeToggle";
import { Search, Menu } from "lucide-react";
import SearchModal from "./SearchModal.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header
    class="border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-950/80 backdrop-blur-md sticky top-0 z-40"
>
    <div
        class="container mx-auto px-4 h-16 flex items-center justify-between max-w-6xl relative"
    >
        <div class="flex items-center gap-8">
            <a
                href={`https://nanokito.com/${lang}/`}
                class="text-lg sm:text-xl font-bold tracking-tight flex items-center gap-2.5 group shrink-0"
            >
                 <img
                    src="/logo.svg"
                    alt="NanoKito Logo"
                    class="w-8 h-8 sm:w-9 sm:h-9 transition-transform group-hover:scale-110 group-hover:rotate-6 duration-300"
                />
                <span
                    class="text-[var(--color-foreground)] font-extrabold tracking-tight"
                    >NanoKito</span
                >
            </a>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-6">
                <a
                    href={`https://nanokito.com/${lang}/`}
                    class="text-sm font-medium text-gray-600 hover:text-amber-500 dark:text-gray-300 dark:hover:text-amber-400 transition-colors"
                >
                    {t("nav.home")}
                </a>
                <a
                    href={`https://nanokito.com/${lang}/tools`}
                    class="text-sm font-medium text-gray-600 hover:text-amber-500 dark:text-gray-300 dark:hover:text-amber-400 transition-colors"
                >
                    {t("nav.tools")}
                </a>
            </nav>
        </div>

        <div class="flex items-center gap-3">
            <!-- Search Trigger -->
            <button
                id="search-trigger-header"
                class="p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors cursor-pointer"
                aria-label="Search"
            >
                <Search className="w-5 h-5" />
            </button>

            <div class="hidden sm:block h-6 w-px bg-gray-200 dark:bg-gray-800">
            </div>

            <ThemeToggle client:load />

            <LanguagePicker />

            <!-- Mobile Menu Toggle -->
            <button
                id="menu-toggle"
                class="md:hidden p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors cursor-pointer"
                aria-label="Menu"
            >
                <Menu className="w-6 h-6" />
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div
        id="mobile-menu"
        class="hidden md:hidden absolute top-16 left-0 w-full bg-white dark:bg-gray-950 border-b border-gray-200 dark:border-gray-800 shadow-lg animate-in slide-in-from-top-2 duration-200"
    >
        <nav class="container mx-auto px-4 py-4 flex flex-col gap-4">
            <a
                href={`https://nanokito.com/${lang}/`}
                class="flex items-center gap-2 text-base font-medium text-gray-600 hover:text-amber-500 dark:text-gray-300 dark:hover:text-amber-400 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"
            >
                {t("nav.home")}
            </a>
            <a
                href={`https://nanokito.com/${lang}/tools`}
                class="flex items-center gap-2 text-base font-medium text-gray-600 hover:text-amber-500 dark:text-gray-300 dark:hover:text-amber-400 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"
            >
                {t("nav.tools")}
            </a>
            <div class="h-px bg-gray-100 dark:bg-gray-800 my-1"></div>
            <button
                id="search-trigger-mobile"
                class="flex items-center gap-2 w-full text-left text-base font-medium text-gray-600 hover:text-amber-500 dark:text-gray-300 dark:hover:text-amber-400 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"
            >
                <Search className="w-5 h-5" />
                {t("hero.searchPlaceholder")}
            </button>
        </nav>
    </div>

    <SearchModal />
</header>

<script>
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const searchTriggers = document.querySelectorAll(
        "#search-trigger-header, #search-trigger-mobile",
    );

    if (menuToggle && mobileMenu) {
        menuToggle.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
        });
    }

    // Search Triggers
    searchTriggers.forEach((trigger) => {
        trigger.addEventListener("click", () => {
            // Close mobile menu if open
            if (mobileMenu && !mobileMenu.classList.contains("hidden")) {
                mobileMenu.classList.add("hidden");
            }
            document.dispatchEvent(new CustomEvent("open-search"));
        });
    });
</script>
